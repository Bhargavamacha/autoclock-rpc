- name: Install a list of packages
  become: true
  become_user: root
  apt:
    update_cache: yes
    pkg:
    - mdadm 

- name: format disks
  become: true
  become_user: root
  shell: (echo p; echo d; echo w) | sudo fdisk {{ item }}
  with_items:
    - "{{ raw_disk_list }}"

- name: raid raw disks
  become: true
  become_user: root
  shell: mdadm --create /dev/md0 --level=0 --raid-devices={{ raw_disk_list|length }} {{ raw_disk_list | join(' ') }}

- name: format disks with ext4
  become: true
  become_user: root
  shell: mkfs.ext4 /dev/md0

- name: mount disks
  become: true
  become_user: root
  shell: mount -o loop /dev/md0 /mnt
